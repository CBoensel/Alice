{% extends "columnar-base.html" %}

{% block head %}
<script>
  function copyToClipboard(id) {
    navigator.clipboard.writeText(document.getElementById(id).value);
  }
  function updateAPICalls(formattedCalls) {
    document.querySelector('#api-calls').click();
    console.log(JSON.stringify(formattedCalls));
    for (var id in formattedCalls) {
      if (formattedCalls.hasOwnProperty(id)) {
        var contents = formattedCalls[id]
        console.log("id", id, "contents", contents);
        var apiCallTab = document.querySelector('#api-calls-' + id);
        apiCallTab.innerHTML += contents;
        var apiCallsButton = document.querySelector('#' + id);
        enableButton(apiCallsButton);
        apiCallsButton.click();
      }
    }
  }
</script>
{% endblock %}

{% block left_col %}
<form id="options-form" class="space-y-4">
  <div class="flex items-center mb-2">
    <label class="w-1/3 block text-sm font-medium text-gray-900 dark:text-gray-300" for="partner-id">Partner ID</label>
    <input class="w-1/2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block p-2 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white font-mono" id="partner-id" value="{{ partner_id }}" disabled>
    <button type="button" class="h-8 w-1/6 p-1 mx-1 bg-blue-600 text-white rounded-lg block uppercase text-xs hover:bg-blue-700 active:bg-blue-800 focus:outline-none focus:ring focus:ring-blue-400" onclick="copyToClipboard('partner-id')">copy</button>
  </div>
  <div class="flex items-center mb-2">
    <label class="w-1/3 block text-sm font-medium text-gray-900 dark:text-gray-300" for="partner-client-id">Client ID</label>
    <input class="w-1/2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white font-mono" id="partner-client-id" value="{{ partner_client_id }}" disabled>
    <button type="button" class="h-8 w-1/6 p-1 mx-1 bg-blue-600 text-white rounded-lg block uppercase text-xs hover:bg-blue-700 active:bg-blue-800 focus:outline-none focus:ring focus:ring-blue-400" onclick="copyToClipboard('partner-client-id')">copy</button>
  </div>
  <div class="flex items-center mb-2">
    <label class="w-1/3 block text-sm font-medium text-gray-900 dark:text-gray-300" for="merchant-id">Merchant ID</label>
    <input class="w-1/2 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block p-2 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white font-mono" id="merchant-id" value="{{ payee_id }}" disabled>
    <button type="button" class="h-8 w-1/6 p-1 mx-1 bg-blue-600 text-white rounded-lg block uppercase text-xs hover:bg-blue-700 active:bg-blue-800 focus:outline-none focus:ring focus:ring-blue-400" onclick="copyToClipboard('merchant-id')">copy</button>
  </div>

  <fieldset>
    <legend class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Intent</legend>

    <div class="flex items-center mb-2">
      <input id="intent-capture" type="radio" name="intent" value="CAPTURE" class="w-4 h-4 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600" checked>
      <label for="intent-capture" class="block ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">
        Capture
      </label>
    </div>

    <div class="flex items-center mb-2">
      <input id="intent-authorize" type="radio" name="intent" value="AUTHORIZE" class="w-4 h-4 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600">
      <label for="intent-authorize" class="block ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">
        Authorize
      </label>
    </div>
  </fieldset>
  <fieldset>
    <legend class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Shipping</legend>

    <div class="flex items-center mb-2">
      <input id="shipping-get" type="radio" name="shipping-preference" value="GET_FROM_FILE" class="w-4 h-4 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600" checked>
      <label for="shipping-get" class="block ml-2 text-sm font-medium text-gray-900 dark:text-gray-300 font-mono">
        GET_FROM_FILE
      </label>
    </div>

    <div class="flex items-center mb-2">
      <input id="shipping-no" type="radio" name="shipping-preference" value="NO_SHIPPING" class="w-4 h-4 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600">
      <label for="shipping-no" class="block ml-2 text-sm font-medium text-gray-900 dark:text-gray-300 font-mono">
        NO_SHIPPING
      </label>
    </div>
  </fieldset>
  <fieldset>
    <legend class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Purchase unit info</legend>

    <div class="flex items-center mb-2">
      <label for="price" class="w-1/2 block ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">
        Price
      </label>
      <input id="price" type="number" name="price" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-1 px-2 text-gray-700 leading-none focus:outline-none focus:bg-white focus:border-blue-500" value="3.14">
    </div>

    <div class="flex items-center mb-2">
      <label for="reference-id" class="w-1/2 block ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">
        Reference ID
      </label>
      <input id="reference-id" type="text" name="reference-id" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-1 px-2 text-gray-700 leading-none focus:outline-none focus:bg-white focus:border-blue-500" value="default">
    </div>

    <div class="flex items-center mb-2">
      <label for="partner-fee" class="w-1/2 block ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">
        Partner fee
      </label>
      <input id="partner-fee" type="number" name="partner-fee" value="0" class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-1 px-2 text-gray-700 leading-none focus:outline-none focus:bg-white focus:border-blue-500">
    </div>
  </fieldset>
</form>
{% endblock %}

{% block right_col %}
<div id="buttons-tabs">
  <!-- Buttons for tabs -->
  <div id="buttons">
    <ul class="flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400">
      <li class="mr-2">
        <a href="#" id="checkout" class="button inline-block p-4 rounded-t-lg text-blue-600 bg-gray-100 active dark:bg-gray-800 dark:text-blue-500">Checkout</a>
      </li>
      <li class="mr-2">
        <a href="#" id="api-calls" class="button inline-block p-4 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 dark:hover:text-gray-300">API Calls</a>
      </li>
    </ul>
  </div> 

  <!-- Tabs -->
  <div id="tabs">
    <div id="tab-checkout" class="tab center text-gray-800 relative">
      <div class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2">
        {% block checkout %}
        <p class="text-xl p-3 px-5 font-semibold">Welcome to Checkout!</p>
        <div class="p-3 px-5">
          Default checkout contents.
        </div> 
        {% endblock %}
      </div>
    </div>
    <div id="tab-api-calls" class="tab center text-gray-800 relative hidden">
      <div id="api-calls-buttons-tabs">
        <!-- Buttons for tabs -->
        <div id="api-calls-buttons">
          <ul class="flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400">
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500" id="access-token">Access Token</a>
            </li>
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500" id="create-order">Create Order</a>
            </li>
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500" id="capture-order">Capture Order</a>
            </li>
          </ul>
        </div> 
      
        <!-- Tabs -->
        <div id="api-calls-tabs">
          <div id="tab-access-token" class="tab center text-gray-800 relative">
            <div id="api-calls-access-token" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
          </div>
          <div id="tab-create-order" class="tab center text-gray-800 relative">
            <div id="api-calls-create-order" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
          </div>
          <div id="tab-capture-order" class="tab center text-gray-800 relative">
            <div id="api-calls-capture-order" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function getOptions() {
    var formData = new FormData(document.getElementById('options-form'));
    var formOptions = Object.fromEntries(formData);
    formOptions['merchant-id'] = document.getElementById('merchant-id').value;
    formOptions['partner-id'] = document.getElementById('partner-id').value;
    return formOptions
  }
</script>
<script>
  function enableButton(button) {
    const disabledClassList = ["text-gray-400", "cursor-not-allowed", "hover:text-gray-600", "dark:text:gray-500"];
    const enabledClassList = ["hover:text-gray-600", "hover:bg-gray-50", "dark:hover:bg-gray-800", "dark:hover:text-gray-300"];

    button.classList.remove(...disabledClassList);
    button.classList.add(...enabledClassList);
  }
  function makeActiveButton(buttonList, button) {
    const activeClassList = ["text-blue-600", "bg-gray-100", "active", "dark:bg-gray-800", "dark:text-blue-500"];
    const inactiveClassList = ["hover:text-gray-600", "hover:bg-gray-50", "dark:hover:bg-gray-800", "dark:hover:text-gray-300"];

    buttonList.forEach(each => {
      each.classList.remove(...activeClassList);
      each.classList.add(...inactiveClassList);
    });

    button.classList.remove(...inactiveClassList);
    button.classList.add(...activeClassList);
  }
  function makeActiveTab(tabList, tab) {
    tabList.forEach(each => {each.classList.add("hidden");});
    tab.classList.remove("hidden");
  }
  const root = document.querySelector("#buttons-tabs");
  const buttonContainer = root.querySelector("#buttons");
  const tabContainer = root.querySelector("#tabs");
  const buttonList = buttonContainer.querySelectorAll(".button");
  const tabList = root.querySelectorAll("#tabs > .tab");
  buttonContainer.onclick = function(e) {
    var button = e.target;
    var buttonId = button.getAttribute("id");
    if (buttonId != null){
      makeActiveButton(buttonList, button);

      var tab = tabContainer.querySelector("#tab-" + buttonId);
      makeActiveTab(tabList, tab);
    }
  }
  const apiCallsRoot = document.querySelector("#api-calls-buttons-tabs");
  const apiCallsButtonContainer = apiCallsRoot.querySelector("#api-calls-buttons");
  const apiCallsTabContainer = apiCallsRoot.querySelector("#api-calls-tabs");
  const apiCallsButtonList = apiCallsButtonContainer.querySelectorAll(".button");
  const apiCallsTabList = apiCallsRoot.querySelectorAll("#api-calls-tabs > .tab");
  apiCallsButtonContainer.onclick = function(e) {
    var button = e.target;
    var buttonId = button.getAttribute("id");
    if (buttonId != null && !button.classList.contains("cursor-not-allowed")) {
      makeActiveButton(apiCallsButtonList, button);

      var tab = apiCallsTabContainer.querySelector("#tab-" + buttonId);
      makeActiveTab(apiCallsTabList, tab);
    }
  }
  
</script>
{% endblock %}