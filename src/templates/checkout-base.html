{% extends "columnar-base.html" %}

{% block head %}
<script>
  function copyToClipboard(id) {
    navigator.clipboard.writeText(document.getElementById(id).value);
  }
  function updateAPICalls(formattedCalls) {
    document.querySelector('#api-calls').click();
    for (var id in formattedCalls) {
      if (formattedCalls.hasOwnProperty(id)) {
        var contents = formattedCalls[id];
        var apiCallTab = document.getElementById('api-calls-' + id);
        apiCallTab.innerHTML = contents;
        var apiCallsButton = document.getElementById(id);
        enableButton(apiCallsButton);
        apiCallsButton.click();
      }
    }
  }
  function hideAuth() {
    var tabAuthorizeOrder = document.getElementById("authorize-order");
    tabAuthorizeOrder.classList.add("hidden");
  }
  function showAuth() {
    var tabAuthorizeOrder = document.getElementById("authorize-order");
    tabAuthorizeOrder.classList.remove("hidden");
  }
</script>
{% endblock %}

{% block left_col %}
<form id="options-form" class="space-y-4">
  <fieldset>
    <legend class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Partner/merchant info</legend>
    <div class="flex flex-row flex-wrap items-center mb-2">
      <label for="partner-id" class="
        ml-2
        flex-none 
        basis-1/3
        text-sm 
        font-medium 
        text-gray-900 
        dark:text-gray-300
      ">
        Partner ID
      </label>
      <input id="partner-id" name="partner-id" class="
        appearance-none
        p-2
        min-w-0
        flex-auto
        basis-2/5
        bg-gray-50 
        border
        border-gray-300 
        text-gray-900
        text-sm
        rounded-lg 
        leading-none 
        font-mono 
        focus:outline-none 
        focus:bg-white 
        focus:border-blue-500
      " value="{{ partner_id }}" disabled>
      <button type="button" class="
        h-8
        basis-1/6
        flex-none
        p-1
        mx-1
        bg-blue-600
        text-white
        rounded-lg
        uppercase
        text-xs
        hover:bg-blue-700
        active:bg-blue-800
        focus:outline-none
        focus:ring
        focus:ring-blue-400
      " onclick="copyToClipboard('partner-id');">copy</button>
    </div>
    <div class="flex flex-row flex-wrap items-center mb-2">
      <label for="partner-client-id" class="
        ml-2
        flex-none 
        basis-1/3
        text-sm 
        font-medium 
        text-gray-900 
        dark:text-gray-300
      ">
        Client ID
      </label>
      <input id="partner-client-id" name="partner-client-id" class="
        appearance-none
        p-2
        min-w-0
        flex-auto
        basis-2/5
        bg-gray-50 
        border
        border-gray-300 
        text-gray-900
        text-sm
        rounded-lg 
        leading-none 
        font-mono 
        focus:outline-none 
        focus:bg-white 
        focus:border-blue-500
      " value="{{ partner_client_id }}" disabled>
      <button type="button" class="
        h-8
        basis-1/6
        flex-none
        p-1
        mx-1
        bg-blue-600
        text-white
        rounded-lg
        uppercase
        text-xs
        hover:bg-blue-700
        active:bg-blue-800
        focus:outline-none
        focus:ring
        focus:ring-blue-400
      " onclick="copyToClipboard('partner-client-id');">copy</button>
    </div>
    <div class="flex flex-row flex-wrap items-center mb-2">
      <label for="merchant-id" class="
        ml-2
        flex-none 
        basis-1/3
        text-sm 
        font-medium 
        text-gray-900 
        dark:text-gray-300
      ">
        Merchant ID
      </label>
      <input id="merchant-id" name="merchant-id" class="
        appearance-none
        p-2
        min-w-0
        flex-auto
        basis-2/5
        bg-gray-50 
        border
        border-gray-300 
        text-gray-900
        text-sm
        rounded-lg 
        leading-none 
        font-mono 
        focus:outline-none 
        focus:bg-white 
        focus:border-blue-500
      " value="{{ payee_id }}" disabled>
      <button type="button" class="
        h-8
        basis-1/6
        flex-none
        p-1
        mx-1
        bg-blue-600
        text-white
        rounded-lg
        uppercase
        text-xs
        hover:bg-blue-700
        active:bg-blue-800
        focus:outline-none
        focus:ring
        focus:ring-blue-400
      " onclick="copyToClipboard('merchant-id');">copy</button>
    </div>
  </fieldset>

  <fieldset>
    <legend class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Intent</legend>

    <div class="flex items-center mb-2">
      <input id="intent-capture" type="radio" name="intent" value="CAPTURE" class="w-4 h-4 ml-2 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600" checked onclick="hideAuth();">
      <label for="intent-capture" class="block ml-2 text-sm text-gray-900 dark:text-gray-300">
        Capture
      </label>
    </div>

    <div class="flex items-center mb-2">
      <input id="intent-authorize" type="radio" name="intent" value="AUTHORIZE" class="w-4 h-4 ml-2 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600" onclick="showAuth();">
      <label for="intent-authorize" class="block ml-2 text-sm text-gray-900 dark:text-gray-300">
        Authorize
      </label>
    </div>
  </fieldset>
  <fieldset>
    <legend class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Shipping</legend>

    <div class="flex items-center mb-2">
      <input id="shipping-get" type="radio" name="shipping-preference" value="GET_FROM_FILE" class="w-4 h-4 ml-2 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600" checked>
      <label for="shipping-get" class="block ml-2 text-sm text-gray-900 dark:text-gray-300 font-mono">
        GET_FROM_FILE
      </label>
    </div>

    <div class="flex items-center mb-2">
      <input id="shipping-no" type="radio" name="shipping-preference" value="NO_SHIPPING" class="w-4 h-4 ml-2 border-gray-300 focus:ring-2 focus:ring-blue-300 dark:focus:ring-blue-600 dark:focus:bg-blue-600 dark:bg-gray-700 dark:border-gray-600">
      <label for="shipping-no" class="block ml-2 text-sm text-gray-900 dark:text-gray-300 font-mono">
        NO_SHIPPING
      </label>
    </div>
  </fieldset>
  <fieldset>
    <legend class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Purchase unit info</legend>

    <div class="flex flex-row flex-wrap items-center mb-2">
      <label for="price" class="
        ml-2
        flex-none 
        basis-1/3
        text-sm 
        font-medium 
        text-gray-900 
        dark:text-gray-300">
        Price
      </label>
      <input id="price" type="number" name="price" class="
        appearance-none
        ml-2
        px-2
        py-1 
        min-w-0
        flex-auto
        basis-1/3
        bg-gray-200 
        border-2 
        border-gray-200 
        text-gray-700 
        rounded 
        leading-none 
        font-mono 
        focus:outline-none 
        focus:bg-white 
        focus:border-blue-500" value="3.14">
    </div>

    <div class="flex flex-row flex-wrap items-center mb-2">
      <label for="reference-id" class="
        ml-2
        flex-none 
        basis-1/3
        text-sm 
        font-medium 
        text-gray-900 
        dark:text-gray-300">
        Reference ID
      </label>
      <input id="reference-id" type="text" name="reference-id" class="
        appearance-none
        ml-2
        px-2
        py-1 
        min-w-0
        flex-auto
        basis-1/3
        bg-gray-200 
        border-2 
        border-gray-200 
        text-gray-700 
        rounded 
        leading-none 
        font-mono 
        focus:outline-none 
        focus:bg-white 
        focus:border-blue-500" value="default">
    </div>

    <div class="flex flex-row flex-wrap items-center mb-2">
      <label for="partner-fee" class="
        ml-2
        flex-none 
        basis-1/3
        text-sm 
        font-medium 
        text-gray-900 
        dark:text-gray-300">
        Partner fee
      </label>
      <input id="partner-fee" type="number" name="partner-fee" value="0" class="
        appearance-none
        ml-2
        px-2
        py-1 
        min-w-0
        flex-auto
        basis-1/3
        bg-gray-200 
        border-2 
        border-gray-200 
        text-gray-700 
        rounded 
        leading-none 
        font-mono 
        focus:outline-none 
        focus:bg-white 
        focus:border-blue-500">
    </div>
  </fieldset>
</form>
{% endblock %}

{% block right_col %}
<div id="buttons-tabs">
  <!-- Buttons for tabs -->
  <div id="buttons">
    <ul class="flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400">
      <li class="mr-2">
        <a href="#" id="checkout" class="button inline-block p-4 rounded-t-lg text-blue-600 bg-gray-100 active dark:bg-gray-800 dark:text-blue-500">Checkout</a>
      </li>
      <li class="mr-2">
        <a href="#" id="api-calls" class="button inline-block p-4 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 dark:hover:text-gray-300">API Calls</a>
      </li>
    </ul>
  </div> 

  <!-- Tabs -->
  <div id="tabs">
    <div id="tab-checkout" class="tab center text-gray-800 relative">
      <div class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2">
        {% block checkout %}
        <p class="text-xl p-3 px-5 font-semibold">Welcome to Checkout!</p>
        <div class="p-3 px-5">
          Default checkout contents.
        </div> 
        {% endblock %}
      </div>
    </div>
    <div id="tab-api-calls" class="tab center text-gray-800 relative hidden">
      <div id="api-calls-buttons-tabs">
        <!-- Buttons for tabs -->
        <div id="api-calls-buttons">
          <ul class="flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400">
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500" id="access-token">Access Token</a>
            </li>
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500" id="create-billing-agreement">Create Billing Agreement</a>
            </li>
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500" id="create-order">Create Order</a>
            </li>
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500 hidden" id="authorize-order">Authorize Order</a>
            </li>
            <li class="mr-2">
              <a href="#" class="button inline-block p-4 rounded-t-lg text-gray-400 cursor-not-allowed hover:text-gray-600 dark:text:gray-500" id="capture-order">Capture Order</a>
            </li>
          </ul>
        </div> 
      
        <!-- Tabs -->
        <div id="api-calls-tabs">
          <div id="tab-access-token" class="tab center text-gray-800 relative">
            <div id="api-calls-access-token" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
          </div>
          <div id="tab-create-billing-agreement" class="tab center text-gray-800 relative">
            <div id="api-calls-create-billing-agreement" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
          </div>
          <div id="tab-create-order" class="tab center text-gray-800 relative">
            <div id="api-calls-create-order" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
          </div>
          <div id="tab-authorize-order" class="tab center text-gray-800 relative">
            <div id="api-calls-authorize-order" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
          </div>
          <div id="tab-capture-order" class="tab center text-gray-800 relative">
            <div id="api-calls-capture-order" class="bg-white rounded-b-md w-full border border-t-0 absolute top-0 p-2 font-mono whitespace-pre-wrap break-words"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function getOptions() {
    var formData = new FormData(document.getElementById('options-form'));
    var formOptions = Object.fromEntries(formData);
    formOptions['merchant-id'] = document.getElementById('merchant-id').value;
    formOptions['partner-id'] = document.getElementById('partner-id').value;
    return formOptions
  }
</script>
<script>
  function enableButton(button) {
    const disabledClassList = ["text-gray-400", "cursor-not-allowed", "hover:text-gray-600", "dark:text:gray-500"];
    const enabledClassList = ["hover:text-gray-600", "hover:bg-gray-50", "dark:hover:bg-gray-800", "dark:hover:text-gray-300"];

    button.classList.remove(...disabledClassList);
    button.classList.add(...enabledClassList);
  }
  function makeActiveButton(buttonList, button) {
    const activeClassList = ["text-blue-600", "bg-gray-100", "active", "dark:bg-gray-800", "dark:text-blue-500"];
    const inactiveClassList = ["hover:text-gray-600", "hover:bg-gray-50", "dark:hover:bg-gray-800", "dark:hover:text-gray-300"];

    buttonList.forEach(each => {
      each.classList.remove(...activeClassList);
      each.classList.add(...inactiveClassList);
    });

    button.classList.remove(...inactiveClassList);
    button.classList.add(...activeClassList);
  }
  function makeActiveTab(tabList, tab) {
    tabList.forEach(each => {each.classList.add("hidden");});
    tab.classList.remove("hidden");
  }
  const root = document.querySelector("#buttons-tabs");
  const buttonContainer = root.querySelector("#buttons");
  const tabContainer = root.querySelector("#tabs");
  const buttonList = buttonContainer.querySelectorAll(".button");
  const tabList = root.querySelectorAll("#tabs > .tab");
  buttonContainer.onclick = function(e) {
    var button = e.target;
    var buttonId = button.getAttribute("id");
    if (buttonId != null){
      makeActiveButton(buttonList, button);

      var tab = tabContainer.querySelector("#tab-" + buttonId);
      makeActiveTab(tabList, tab);
    }
  }
  const apiCallsRoot = document.querySelector("#api-calls-buttons-tabs");
  const apiCallsButtonContainer = apiCallsRoot.querySelector("#api-calls-buttons");
  const apiCallsTabContainer = apiCallsRoot.querySelector("#api-calls-tabs");
  const apiCallsButtonList = apiCallsButtonContainer.querySelectorAll(".button");
  const apiCallsTabList = apiCallsRoot.querySelectorAll("#api-calls-tabs > .tab");
  apiCallsButtonContainer.onclick = function(e) {
    var button = e.target;
    var buttonId = button.getAttribute("id");
    if (buttonId != null && !button.classList.contains("cursor-not-allowed")) {
      makeActiveButton(apiCallsButtonList, button);

      var tab = apiCallsTabContainer.querySelector("#tab-" + buttonId);
      makeActiveTab(apiCallsTabList, tab);
    }
  }
</script>
{% endblock %}